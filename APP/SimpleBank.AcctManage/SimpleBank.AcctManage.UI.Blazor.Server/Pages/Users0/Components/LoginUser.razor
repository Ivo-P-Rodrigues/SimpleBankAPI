@using SimpleBank.AcctManage.UI.Blazor.Server.Services
@using SimpleBank.AcctManage.UI.Blazor.Server.Services.Requests
@inject AuthService authService

<div class="container-md rounded dualBox dropshadow">

    <h4>Login</h4>

    <EditForm Model="@loginUserRequest" OnSubmit="CallAPIToLogin">
        <DataAnnotationsValidator />

        <div class="form-group">
            @*<label for="inputUsername1">@Loc["Username"]</label>*@
            <InputText class="form-control" id="inputUsername1" aria-describedby="usernameHelp" placeholder="Username" @bind-Value="loginUserRequest.Username" />
            <ValidationMessage For="@(() => loginUserRequest.Username)"></ValidationMessage>
            @*<small id="usernameHelp" class="form-text text-muted">Insert your username.</small>*@
        </div>

        <div class="form-group">
            @*<label for="inputPassword1">@Loc["Password"]</label>*@
            <InputText type="password" class="form-control" id="inputPassword1" placeholder="Password" @bind-Value="loginUserRequest.Password" />
            <ValidationMessage For="@(() => loginUserRequest.Password)"></ValidationMessage>
        </div>

        <button type="submit" class="btn btn-dark">Login</button>
        <button class="btn-sm btn-outline-dark float-right" @onclick="@AutoFill">AutoFill</button>
    </EditForm>
   
    @if (errorOnLogin)
    {
        <hr /><br />
        <p style="color:red">LoginError</p>
    }

</div>


@code {

    [Parameter]
    public EventCallback<bool> OnUserLogginIn { get; set; }

    private bool errorOnLogin = false;
    private LoginUserRequest loginUserRequest = new();
    
    private void AutoFill() => loginUserRequest = new LoginUserRequest() { Username = "Dummytester2", Password = "123456789" };

    private async Task CallAPIToLogin()
    {
        var userLogged = await authService.Login(loginUserRequest);
        if (!userLogged) { errorOnLogin = true; }
        else { await OnUserLogginIn.InvokeAsync(true); }
    }



}
